{% include "base.html" %}

<div class="">
  <header class="absolute inset-x-0 top-0 z-50">
  {% include 'navbar.html' %}
  </header>

  <div class="relative isolate px-6 pt-14 lg:px-8">
    <div aria-hidden="true" class="absolute inset-x-0 -top-40 -z-10 transform-gpu overflow-hidden blur-3xl sm:-top-80">
      <div style="clip-path: polygon(74.1% 44.1%, 100% 61.6%, 97.5% 26.9%, 85.5% 0.1%, 80.7% 2%, 72.5% 32.5%, 60.2% 62.4%, 52.4% 68.1%, 47.5% 58.3%, 45.2% 34.5%, 27.5% 76.7%, 0.1% 64.9%, 17.9% 100%, 27.6% 76.8%, 76.1% 97.7%, 74.1% 44.1%)" class="relative left-[calc(50%-11rem)] aspect-1155/678 w-144.5 -translate-x-1/2 rotate-30 bg-linear-to-tr from-[#ff80b5] to-[#9089fc] opacity-30 sm:left-[calc(50%-30rem)] sm:w-288.75"></div>
    </div>
    <div class="mx-auto max-w-2xl py-32 sm:py-48 lg:py-56">
      <div class="text-center">
        <h1 class="text-5xl font-semibold tracking-tight text-balance text-gray-900 sm:text-7xl">Violence against women is increasing. <span class="ml-2 text-purple-600">But why?</span> </h1>
        
        <section class="mx-auto mt-10 max-w-4xl">
  <div class="grid gap-4 sm:grid-cols-2">
    <article class="rounded-2xl border border-gray-200 bg-white p-5 shadow-sm">
      <div class="flex items-start justify-between">
        <div>
          <p class="text-sm font-medium text-gray-600">Victims of sexual violence</p>
          <p class="mt-1 text-2xl font-semibold text-gray-900">350,127</p>
          <p class="text-xs text-gray-500">Reported in <span class="font-medium">2022</span></p>
        </div>
      </div>
      <div class="mt-3 text-sm text-gray-700">
        <span class="font-medium text-gray-900">336,783</span> in 2021 → 
        <span class="font-medium text-gray-900">350,127</span> in 2022
      </div>
    </article>

    <!-- Rate per 100k card -->
    <article class="rounded-2xl border border-gray-200 bg-white p-5 shadow-sm">
      <div class="flex items-start justify-between">
        <div>
          <p class="text-sm font-medium text-gray-600">Rate per 100,000 population</p>
          <p class="mt-1 text-2xl font-semibold text-gray-900">48.8</p>
          <p class="text-xs text-gray-500">Latest year: <span class="font-medium">2022</span></p>
        </div>
        <span class="inline-flex items-center gap-1 rounded-full bg-sky-50 px-2 py-1 text-xs font-semibold text-sky-700">
          <svg class="h-3 w-3" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><path d="M4 12h16M12 4v16" stroke-linecap="round" stroke-linejoin="round"/></svg>
          overview
        </span>
      </div>
      <div class="mt-3 text-sm text-gray-700">
        Regional comparison available below.
      </div>
    </article>
  </div>
</section>
      </div>
    </div>
    <div aria-hidden="true" class="absolute inset-x-0 top-[calc(100%-13rem)] -z-10 transform-gpu overflow-hidden blur-3xl sm:top-[calc(100%-30rem)]">
      <div style="clip-path: polygon(74.1% 44.1%, 100% 61.6%, 97.5% 26.9%, 85.5% 0.1%, 80.7% 2%, 72.5% 32.5%, 60.2% 62.4%, 52.4% 68.1%, 47.5% 58.3%, 45.2% 34.5%, 27.5% 76.7%, 0.1% 64.9%, 17.9% 100%, 27.6% 76.8%, 76.1% 97.7%, 74.1% 44.1%)" class="relative left-[calc(50%+3rem)] aspect-1155/678 w-144.5 -translate-x-1/2 bg-linear-to-tr from-[#ff80b5] to-[#9089fc] opacity-30 sm:left-[calc(50%+36rem)] sm:w-288.75"></div>
    </div>
  </div>
</div>

<div class="relative isolate overflow-hidden  py-24 sm:py-32">
  <img src="../static/assets/womansmiling.jpg" alt="" class="absolute inset-0 -z-10 size-full object-cover object-right opacity-10 md:object-center" />
  <div aria-hidden="true" class="hidden sm:absolute sm:-top-10 sm:right-1/2 sm:-z-10 sm:mr-10 sm:block sm:transform-gpu sm:blur-3xl">
    <div style="clip-path: polygon(74.1% 44.1%, 100% 61.6%, 97.5% 26.9%, 85.5% 0.1%, 80.7% 2%, 72.5% 32.5%, 60.2% 62.4%, 52.4% 68.1%, 47.5% 58.3%, 45.2% 34.5%, 27.5% 76.7%, 0.1% 64.9%, 17.9% 100%, 27.6% 76.8%, 76.1% 97.7%, 74.1% 44.1%)" class="aspect-1097/845 w-274.25 bg-linear-to-tr from-[#ff4694] to-[#776fff] opacity-15"></div>
  </div>
  <div aria-hidden="true" class="absolute -top-52 left-1/2 -z-10 -translate-x-1/2 transform-gpu blur-3xl sm:-top-112 sm:ml-16 sm:translate-x-0">
    <div style="clip-path: polygon(74.1% 44.1%, 100% 61.6%, 97.5% 26.9%, 85.5% 0.1%, 80.7% 2%, 72.5% 32.5%, 60.2% 62.4%, 52.4% 68.1%, 47.5% 58.3%, 45.2% 34.5%, 27.5% 76.7%, 0.1% 64.9%, 17.9% 100%, 27.6% 76.8%, 76.1% 97.7%, 74.1% 44.1%)" class="aspect-1097/845 w-274.25 bg-linear-to-tr from-[#ff4694] to-[#776fff] opacity-15"></div>
  </div>
  <div class="mx-auto max-w-7xl px-6 lg:px-8">
    <div class="mx-auto max-w-2xl lg:mx-0">
      <h2 class="text-5xl font-semibold tracking-tight text-gray-900 sm:text-7xl">Global Reach</h2>
      <p class="mt-8 text-lg font-medium text-pretty text-gray-700 sm:text-xl/8">We believe awareness can save lives. Together with NGOs, educators, and developers, we are building tools to make data visible and actionable.</p>
    </div>
    <div class="mx-auto mt-10 max-w-2xl lg:mx-0 lg:max-w-none">
      <dl class="mt-16 grid grid-cols-1 gap-8 sm:mt-20 sm:grid-cols-2 lg:grid-cols-4">
        <div class="flex flex-col-reverse gap-1">
          <dt class="text-base/7 text-gray-700">Countries covered</dt>
          <dd class="text-4xl font-semibold tracking-tight text-gray-900">120</dd>
        </div>
        <div class="flex flex-col-reverse gap-1">
          <dt class="text-base/7 text-gray-700">Years of data</dt>
          <dd class="text-4xl font-semibold tracking-tight text-gray-900">2013-2022</dd>
        </div>
        <div class="flex flex-col-reverse gap-1">
          <dt class="text-base/7 text-gray-700">Organizations</dt>
          <dd class="text-4xl font-semibold tracking-tight text-gray-900">UNODC, WHO, NGOs</dd>
        </div>
      </dl>
    </div>
  </div>
</div>

{% include 'country.html' %}
<section class="mx-auto max-w-4xl my-12">
  <h2 class="text-center font-bold text-xl text-gray-800">Sexual Violence Ranked by Country <p class="font-medium text-sm ">(Higher to lower)</p> </h2>
  <div class="mb-4 flex items-center gap-3">
    <label for="year-select" class="text-sm font-medium text-gray-700">Year:</label>
    <select id="year-select" class="rounded-md border px-3 py-2 text-sm shadow-">
      <option selected>2022</option>
      {% for i in range(2013, 2022) %}
      <option> {{i}} </option>
      {% endfor %}
    </select>
  </div>
  <div id="rates-table" class="rounded-xl border bg-white p-4 shadow-sm">Loading…</div>
</section>
{% include 'methods.html' %}
{% include 'help.html' %}

<script>
  
  function renderTable(container ,rows){
    const table = document.createElement('table')
    table.className = "w-full text-sm"
    table.innerHTML = `
    <thead>
        <tr class="text-left border-b">
          <th class="py-2 pr-4">#</th>
          <th class="py-2 pr-4">Country</th>
          <th class="py-2 pr-4">ISO3</th>
          <th class="py-2">Rate Per 100K</th>
        </tr>
      </thead>
      <tbody></tbody>
    `
    const tbody = table.querySelector('tbody')
    rows.forEach((r, i) => {
      const tr = document.createElement('tr')
      tr.className = "border-b hover:bg-gray-50 cursor-pointer";
      tr.innerHTML = `
        <td class="py-2 pr-4">${i + 1}</td>
        <td class="py-2 pr-4">${r.country}</td>
        <td class="py-2 pr-4">${r.iso3_code}</td>
        <td class="py-2">${(+r.value).toFixed(2)}</td>
      `
      tr.onclick = () => loadCountry(r.iso3_code)
      tbody.appendChild(tr)
    })
    container.innerHTML = ""
    container.appendChild(table)
  }

  async function loadCountry(iso3) {
    const res = await fetch(`${API_BASE}/country/${iso3}`)
    if (!res.ok) throw new Error(`Failed to load the data for ${iso3}`)
    return res.json()
  }
  
  (async function init(){
    const container = document.getElementById("rates-table")
    const yearSel = document.getElementById("year-select")

    try {
      const {results, year} = await loadRates(yearSel.value)
      renderTable(container, results);
    } catch (e) {
      container.textContent = "Failed to load the data."
      console.error(e)
    }

    yearSel.addEventListener("change", async () => {
      container.textContent = "Loading..."
      const {results} = await loadRates(yearSel.value)
      renderTable(container, results)
    })
  })()
</script>