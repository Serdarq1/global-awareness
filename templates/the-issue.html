{% include 'base.html' %}
{% include 'navbar.html' %}

<main class="min-h-screen bg-gray-50">
  <section class="border-b border-gray-200">
    <div class="mx-auto max-w-7xl px-6 py-12 lg:py-16">
      <nav class="text-sm text-gray-500" aria-label="Breadcrumb">
        <ol class="flex items-center gap-2">
          <li><a href="/" class="hover:underline">Home</a></li>
          <li aria-hidden="true" class="text-gray-400">/</li>
          <li class="text-gray-700 font-medium">Understanding the Issue</li>
        </ol>
      </nav>
      <div class="mt-6 grid gap-8 lg:grid-cols-2 items-start">
        <div>
          <h1 class="text-3xl font-bold tracking-tight text-gray-900 sm:text-4xl">Understanding Sexual Violence</h1>
          <p class="mt-3 max-w-2xl text-gray-600">This page explains key definitions, how to read the data, and why rates and counts can look different across countries and years.</p>
          <div class="mt-6 flex gap-3">
            <a href="{{url_for('awareness')}}" class="inline-flex items-center rounded-xl border border-gray-300 bg-white px-4 py-2 text-sm font-semibold text-gray-900 shadow-sm hover:bg-gray-50">Awareness & Action</a>
            <a href="{{url_for('what_you_can_do')}}" class="inline-flex items-center rounded-xl bg-purple-600 px-4 py-2 text-sm font-semibold text-white shadow-sm hover:bg-purple-500">What You Can Do</a>
          </div>
        </div>
      </div>
    </div>
  </section>

  <section class="mx-auto max-w-7xl px-6 py-12">
    <div class="grid gap-8 lg:grid-cols-3">
      <div class="lg:col-span-2">
        <h2 class="text-xl font-semibold text-gray-900">Key concepts</h2>
        <div class="mt-4 space-y-6 text-gray-700">
          <div>
            <h3 class="font-medium text-gray-900">What is “rate per 100,000 population”?</h3>
            <p class="mt-2 text-sm">A normalized measure that divides the number of recorded incidents by population, then multiplies by 100,000. This lets us compare across places with different population sizes.</p>
          </div>
          <div>
            <h3 class="font-medium text-gray-900">Why rates vs counts can diverge</h3>
            <p class="mt-2 text-sm">Counts reflect the number of recorded incidents. Rates account for population. A small country can have a high rate with a modest count; large countries can have high counts but moderate rates.</p>
          </div>
          <div>
            <h3 class="font-medium text-gray-900">Data coverage & caveats</h3>
            <ul class="mt-2 list-disc pl-5 text-sm space-y-1">
              <li>Not all countries report every year; gaps are common.</li>
              <li>Legal definitions and reporting practices differ by jurisdiction.</li>
              <li>Underreporting is a global issue; trends over time can be more informative than single-year rankings.</li>
            </ul>
          </div>
        </div>
      </div>
      <aside class="rounded-2xl bg-white ring-1 ring-gray-200 p-5 shadow-sm">
        <h3 class="text-sm font-medium text-gray-700">How to read this dataset</h3>
        <ul class="mt-2 list-disc pl-5 text-sm text-gray-700 space-y-1">
          <li>The site shows the latest year by default; older years are available per country.</li>
          <li>Regional averages compare a country’s latest year with its region’s mean.</li>
          <li>Use trends to contextualize year-to-year fluctuations.</li>
        </ul>
      </aside>
    </div>
  </section>

  <section class="mx-auto max-w-7xl px-6 pb-16">
    <div class="rounded-2xl bg-white ring-1 ring-gray-200 p-6 shadow-sm">
      <h2 class="text-xl font-semibold text-gray-900">Frequently asked questions</h2>
      <div class="mt-4 grid gap-6 md:grid-cols-2">
        <details class="rounded-xl bg-gray-50 p-4">
          <summary class="text-sm font-semibold text-gray-900 cursor-pointer">Why do some countries appear as N/A?</summary>
          <p class="mt-2 text-sm text-gray-700">They may not have reported data for the latest global year, or naming/ISO mapping may differ. Older years can still be available in the country view.</p>
        </details>
        <details class="rounded-xl bg-gray-50 p-4">
          <summary class="text-sm font-semibold text-gray-900 cursor-pointer">Is the average rate population-weighted?</summary>
          <p class="mt-2 text-sm text-gray-700">No—by default we show an unweighted mean across reporting countries for the selected year to avoid bias from population size. A population-weighted view can be added if needed.</p>
        </details>
      </div>
    </div>
  </section>
</main>

{% include 'help.html' %}

<script>
  window.API_BASE = window.API_BASE || "{{ api_base|default('') }}";

  async function _loadRates(params = {}) {
    const qs = new URLSearchParams(params).toString();
    const res = await fetch(`${API_BASE}/rates${qs ? `?${qs}` : ''}`);
    if (!res.ok) throw new Error('Failed to load rates');
    return res.json();
  }

  (async function initUnderstanding(){
    const y = document.getElementById('u-year');
    const n = document.getElementById('u-n');
    const a = document.getElementById('u-avg');
    const m = document.getElementById('u-med');

    try {
      const { year, results } = await _loadRates();
      const vals = results.map(r => Number(r.value)).filter(Number.isFinite);
      vals.sort((x,y)=>x-y);
      const avg = vals.length ? vals.reduce((s,v)=>s+v,0)/vals.length : NaN;
      const med = vals.length ? (vals.length%2? vals[(vals.length-1)/2] : (vals[vals.length/2-1]+vals[vals.length/2])/2) : NaN;

      if (y) y.textContent = year ?? '—';
      if (n) n.textContent = results.length.toString();
      if (a) a.textContent = Number.isFinite(avg) ? avg.toFixed(2) : '—';
      if (m) m.textContent = Number.isFinite(med) ? med.toFixed(2) : '—';
    } catch (e) {
      console.error(e);
    }
  })();
</script>